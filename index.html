<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Market Map</title>

  <link rel="stylesheet" href="style.css">
 
</head>
<body>

  <header>
    <img src="Media/Screenshot 2025-08-14 105531.png" alt="Adelaide Central Market Logo">
  </header>

   <!-- Search -->
  <div id="search-wrapper">
    <input type="text" id="search-input" placeholder="Search for a stall..." />
    <div id="search-dropdown"></div>
  </div>


  <!-- Tag Filter Buttons -->
  <div id="tag-buttons">
    <button data-tag="Meat, Poultry & Seafood">Meat, Poultry & Seafood</button>
    <button data-tag="Bakeries & Patisserie">Bakeries & Patisserie</button>
    <button data-tag="Gluten Free">Gluten Free</button>
    <button data-tag="Cafes & Eateries">Cafes & Eateries</button>
    <button data-tag="Continental & Cheese">Continental & Cheese</button>
    <button data-tag="Specialty Food">Specialty Food</button>
    <button data-tag="Fruit & Veg">Fruit & Veg</button>
    <button data-tag="Non-Produce">Non-Produce</button>
    <button data-tag="Nuts Confectionery & Coffee">Nuts Confectionery & Coffee</button>
    <button data-tag="Pop-Up">Pop-Up</button>
    <button data-tag="Utilitys">Utilitys</button>
  </div>

 
  <div id="map-wrapper">
    <div id="map-container"></div>
  </div>

  <!-- Info Box -->
  <div id="info-box">
    <button id="close-btn">Close</button>
    <h2 id="stall-name"></h2>
    <p id="stall-tags"></p>
    <img src="" alt="">
    
  </div>
<script>
const mapWrapper = document.getElementById('map-wrapper');
const mapContainer = document.getElementById('map-container');
const infoBox = document.getElementById('info-box');
const stallNameEl = document.getElementById('stall-name');
const stallTagsEl = document.getElementById('stall-tags');
const closeBtn = document.getElementById('close-btn');
const tagButtons = document.querySelectorAll('#tag-buttons button');
const searchInput = document.getElementById('search-input');
const searchDropdown = document.getElementById('search-dropdown');

let isPanning = false;
let isDragging = false;
let dragThreshold = 5;
let dragStartX = 0;
let dragStartY = 0;
let startX = 0;
let startY = 0;
let translateX = 0;
let translateY = 0;
let scale = 1;
let lastDistance = null;

let stalls = [];
let stallElements = [];

function updateTransform() {
  mapContainer.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
}

// --- Mouse Pan ---
mapWrapper.addEventListener('mousedown', e => {
  isPanning = true;
  isDragging = false;
  dragStartX = e.clientX;
  dragStartY = e.clientY;
  startX = translateX;
  startY = translateY;
  mapWrapper.style.cursor = 'grabbing';
});

mapWrapper.addEventListener('mousemove', e => {
  if (!isPanning) return;
  const dx = e.clientX - dragStartX;
  const dy = e.clientY - dragStartY;

  if (!isDragging && Math.sqrt(dx*dx + dy*dy) > dragThreshold) {
    isDragging = true;
  }

  if (isDragging) {
    translateX = startX + dx;
    translateY = startY + dy;
    updateTransform();
  }
});

mapWrapper.addEventListener('mouseup', () => {
  isPanning = false;
  isDragging = false;
  mapWrapper.style.cursor = 'grab';
});

mapWrapper.addEventListener('mouseleave', () => {
  isPanning = false;
  isDragging = false;
  mapWrapper.style.cursor = 'grab';
});

// --- Mouse Wheel Zoom at Cursor ---
mapWrapper.addEventListener('wheel', e => {
  e.preventDefault();
  const rect = mapWrapper.getBoundingClientRect();
  const offsetX = e.clientX - rect.left;
  const offsetY = e.clientY - rect.top;

  const scaleAmount = -e.deltaY * 0.001;
  const newScale = Math.min(Math.max(0.5, scale + scaleAmount), 3);

  translateX -= (offsetX - translateX) * (newScale / scale - 1);
  translateY -= (offsetY - translateY) * (newScale / scale - 1);

  scale = newScale;
  updateTransform();
});

// --- Touch Pan & Pinch Zoom ---
mapWrapper.addEventListener('touchstart', e => {
  if (e.touches.length === 1) {
    isPanning = true;
    isDragging = false;
    dragStartX = e.touches[0].clientX;
    dragStartY = e.touches[0].clientY;
    startX = translateX;
    startY = translateY;
  } else if (e.touches.length === 2) {
    isPanning = false;
    lastDistance = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
  }
});

mapWrapper.addEventListener('touchmove', e => {
  if (e.touches.length === 1 && isPanning) {
    const dx = e.touches[0].clientX - dragStartX;
    const dy = e.touches[0].clientY - dragStartY;

    if (!isDragging && Math.sqrt(dx*dx + dy*dy) > dragThreshold) {
      isDragging = true;
    }

    if (isDragging) {
      translateX = startX + dx;
      translateY = startY + dy;
      updateTransform();
    }
  } else if (e.touches.length === 2) {
    const midX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
    const midY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
    const distance = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );

    if (lastDistance) {
      const zoom = distance / lastDistance;
      const newScale = Math.min(Math.max(0.5, scale * zoom), 3);

      translateX -= (midX - translateX) * (newScale / scale - 1);
      translateY -= (midY - translateY) * (newScale / scale - 1);

      scale = newScale;
      updateTransform();
    }
    lastDistance = distance;
  }
});

mapWrapper.addEventListener('touchend', e => {
  if (e.touches.length < 2) lastDistance = null;
  if (e.touches.length === 0) isPanning = false;
  isDragging = false;
});

// --- Load SVG & JSON ---
Promise.all([
      fetch('./Map-asset.svg').then(r => r.text()),
      fetch('./stalls.json').then(r => r.json())
])
.then(([svgText, stallData]) => {
  mapContainer.innerHTML = svgText;

  Object.keys(stallData).forEach(stallId => {
    const stallEl = document.getElementById(stallId);
    if (stallEl) {
      stallEl.classList.add('stall');
      stallEl.dataset.name = stallData[stallId].name;
      stallEl.dataset.tags = stallData[stallId].tags.join(',');
    }
  });

  stalls = mapContainer.querySelectorAll('.stall');
  stallElements = Array.from(stalls);

  // --- Highlight single stall ---
  stalls.forEach(stall => {
    stall.addEventListener('click', e => {
      if (!isDragging) highlightStall(stall);
    });
  });

  // --- Close info box ---
  closeBtn.addEventListener('click', () => {
    infoBox.classList.remove('active');
    stalls.forEach(s => {
      s.style.filter = 'none';
      const r = s.querySelector('rect');
      if (r) r.style.outline = 'none';
    });
  });

  // --- Tag buttons ---
  tagButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const tag = btn.dataset.tag.toLowerCase();
      stalls.forEach(s => {
        const stallTags = (s.dataset.tags || '').toLowerCase();
        const rect = s.querySelector('rect');
        if (!rect) return;
        if (stallTags.includes(tag)) {
          s.style.filter = 'none';
          rect.style.outline = 'none';
        } else {
          s.style.filter = 'grayscale(100%)';
        }
      });
    });
  });

  // --- Search ---
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    searchDropdown.innerHTML = '';
    if (!query) return searchDropdown.style.display = 'none';

    const matches = stallElements.filter(s => s.dataset.name.toLowerCase().includes(query));
    if (matches.length === 0) return searchDropdown.style.display = 'none';

    matches.forEach(s => {
      const div = document.createElement('div');
      div.textContent = s.dataset.name;
      div.addEventListener('click', () => {
        highlightStall(s);
        searchDropdown.style.display = 'none';
        searchInput.value = s.dataset.name;
      });
      searchDropdown.appendChild(div);
    });

    searchDropdown.style.display = 'block';
  });

  document.addEventListener('click', e => {
    if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
      searchDropdown.style.display = 'none';
    }
  });

  // --- Highlight function ---
  function highlightStall(stall) {
    stalls.forEach(s => {
      s.style.filter = 'grayscale(100%)';
      const r = s.querySelector('rect');
      if (r) r.style.outline = 'none';
    });
    stall.style.filter = 'none';
    const rect = stall.querySelector('rect');
    if (rect) {
      rect.style.outline = '3px solid #a4634e';
      rect.style.outlineOffset = '2px';
    }
    stallNameEl.textContent = stall.dataset.name;
    stallTagsEl.textContent = stall.dataset.tags ? "Tags: " + stall.dataset.tags : "No tags available.";
    infoBox.classList.add('active');
  }

})
.catch(err => console.error('Error loading SVG or JSON:', err));
</script>


</body>
</html>








